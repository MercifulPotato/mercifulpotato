Item(by='noncoml', descendants=None, kids=[25702960, 25702847], score=None, time=1610214775, title=None, item_type='comment', url=None, parent=25701959, text='The meat of it is:<p>the functions (for copying data) used for syscall and mmap are very different, and not only in the name.<p>__memmove_avx_unaligned_erms, called in the mmap experiment, is implemented using Advanced Vector Extensions (AVX) (here is the source code of the functions that it relies on).<p>The implementation of copy_user_enhanced_fast_string, on the other hand, is much more modest. That, in my opinion, is the huge reason why mmap is faster. Using wide vector instructions for data copying effectively utilizes the memory bandwidth, and combined with CPU pre-fetching makes mmap really really fast.<p>Why canâ€™t the kernel implementation use AVX? Well, if it did, then it would have to save and restore those registers on each system call, and that would make domain crossing even more expensive. So this was a conscious decision in the Linux kernel')