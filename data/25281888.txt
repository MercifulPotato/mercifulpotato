Item(by='phiresky', descendants=None, kids=None, score=None, time=1606944535, title=None, item_type='comment', url=None, parent=25280300, text='&gt; If you file an issue against ripgrep proper with code links and some more details<p>Sorry, I don&#x27;t think I explained my issue very well. In general it has nothing to do with the interaction with ripgrep, that works fine.<p>It&#x27;s that each adapter (e.g. zip -&gt; list of file streams) needs to have an interface of fn(Read) -&gt; Iter&lt;ReadWithMeta&gt;<p>But then if there&#x27;s a PDF within the zip, I have to give the returned ReadWithMeta to the PDF adapter - but it can&#x27;t take ownership, because the Archive file iterators only give borrowed reads. I maybe worked around this by creating a wrapper type [3] and adding an unsafe here [2], but something deadlocks when adapting zip files currently.<p>Also, for external programs, I have to copy the data from the Read into a Write (stdin of the program) - which needs to happen in a separate thread, otherwise the stdout is never read [1], but some Reads I have aren&#x27;t Send since they come from e.g. zip-rs, so they can&#x27;t be passed to a thread.<p>[1] <a href="https:&#x2F;&#x2F;github.com&#x2F;phiresky&#x2F;ripgrep-all&#x2F;blob&#x2F;baca166fdab3d2466ac9c482c3c9b8e160014b9a&#x2F;src&#x2F;adapters&#x2F;spawning.rs#L118" rel="nofollow">https:&#x2F;&#x2F;github.com&#x2F;phiresky&#x2F;ripgrep-all&#x2F;blob&#x2F;baca166fdab3d24...</a><p>[2] <a href="https:&#x2F;&#x2F;github.com&#x2F;phiresky&#x2F;ripgrep-all&#x2F;blob&#x2F;baca166fdab3d2466ac9c482c3c9b8e160014b9a&#x2F;src&#x2F;recurse.rs#L23" rel="nofollow">https:&#x2F;&#x2F;github.com&#x2F;phiresky&#x2F;ripgrep-all&#x2F;blob&#x2F;baca166fdab3d24...</a><p>[3] <a href="https:&#x2F;&#x2F;github.com&#x2F;phiresky&#x2F;ripgrep-all&#x2F;blob&#x2F;baca166fdab3d2466ac9c482c3c9b8e160014b9a&#x2F;src&#x2F;adapters&#x2F;zip.rs#L52" rel="nofollow">https:&#x2F;&#x2F;github.com&#x2F;phiresky&#x2F;ripgrep-all&#x2F;blob&#x2F;baca166fdab3d24...</a>')