Item(by='jlgaddis', descendants=None, kids=None, score=None, time=1601764459, title=None, item_type='comment', url=None, parent=24673666, text='systemd [0], which you&#x27;re probably already using, can do IP Accounting:<p>&gt; <i>TL;DR: systemd now can do per-service IP traffic accounting, as well as access control for IP address ranges.</i><p>It can be enabled using:<p><pre><code>  [Service]\n  IPAccounting=yes\n</code></pre>\nsystemd won&#x27;t, AFAIK, give you per second values -- just the aggregate totals -- so you&#x27;d have to constantly retrieve the updated values and calculate the differences yourself. The totals can be obtained programmatically via the D-Bus APIs. They&#x27;ll also be shown in the &quot;systemctl status ...&quot; output or you can grab just the value(s) you&#x27;re interested in with &quot;systemctl show ...&quot;.<p>However...<p>systemd&#x27;s functionality is basically just a thin wrapper around eBPF (in the kernel, since sometime around 4.8, I think?) so you can do it <i>without</i> systemd too.<p>In fact, the author of this article has <i>also</i> written a nice introduction to XDP and eBPF [1]! That article includes an example &quot;XDP program&quot; which counts the number of packets that have been blocked from a list of source IP addresses -- it could be modified fairly easily to do what you want, I think.<p>---<p>[0]: <a href="http:&#x2F;&#x2F;0pointer.net&#x2F;blog&#x2F;ip-accounting-and-access-lists-with-systemd.html" rel="nofollow">http:&#x2F;&#x2F;0pointer.net&#x2F;blog&#x2F;ip-accounting-and-access-lists-with...</a><p>[1]: <a href="https:&#x2F;&#x2F;jvns.ca&#x2F;blog&#x2F;2017&#x2F;04&#x2F;07&#x2F;xdp-bpf-tutorial&#x2F;" rel="nofollow">https:&#x2F;&#x2F;jvns.ca&#x2F;blog&#x2F;2017&#x2F;04&#x2F;07&#x2F;xdp-bpf-tutorial&#x2F;</a>')