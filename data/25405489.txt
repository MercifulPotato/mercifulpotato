Item(by='drothlis', descendants=None, kids=[25405595], score=None, time=1607853897, title=None, item_type='comment', url=None, parent=25404312, text='I too was surprised that OP&#x27;s imgdiff is &quot;3X faster than the fastest in the world pixel-by-pixel image difference tool&quot;. I would have expected imagemagick etc to be faster.<p>Here&#x27;s some Python code (using OpenCV &amp; numpy) that is roughly equivalent to OP&#x27;s imgdiff. It is single-threaded but it&#x27;ll be vectorised and it&#x27;s 3x faster on my 5-year-old 2-core laptop (even counting the Python overhead):<p><pre><code>  import sys, cv2, numpy\n  \n  f1 = cv2.imread(sys.argv[1])\n  f1 = cv2.cvtColor(f1, cv2.COLOR_BGR2GRAY)\n  f2 = cv2.imread(sys.argv[2])\n  f2 = cv2.cvtColor(f2, cv2.COLOR_BGR2GRAY)\n  threshold = 0.1\n  \n  absdiff = cv2.absdiff(f1, f2)\n  _, thresholded = cv2.threshold(\n      absdiff, int(threshold * 255),\n      255, cv2.THRESH_BINARY)\n  \n  cv2.imwrite(&quot;output.png&quot;, thresholded)\n  print(&quot;Different pixels: %s&quot; % numpy.count_nonzero(thresholded))\n</code></pre>\nBenchmark:<p><pre><code>  $ &#x2F;usr&#x2F;bin&#x2F;time python test.py water-4k.png water-4k-2.png\n  Different pixels: 89153\n  1.39user 0.34system 0:01.33elapsed 129%CPU\n\n  $ &#x2F;usr&#x2F;bin&#x2F;time .&#x2F;imgdiff water-4k.png water-4k-2.png output.png\n  Failure! Images are different.\n  Different pixels: 89142\n  Command exited with non-zero status 1\n  8.85user 0.10system 0:04.02elapsed 222%CPU\n</code></pre>\n(Edit: The Python code is a simplified version extracted from <a href="https:&#x2F;&#x2F;github.com&#x2F;stb-tester&#x2F;stb-tester" rel="nofollow">https:&#x2F;&#x2F;github.com&#x2F;stb-tester&#x2F;stb-tester</a> -- we use it for regression testing of GUI screenshots.)')