Item(by='scottlamb', descendants=None, kids=[24843527], score=None, time=1603236905, title=None, item_type='comment', url=None, parent=24843233, text='It looks like the mmap call is not within the timed region in do_mmap_test. I&#x27;d call that a major flaw in the test methodology when combined with MAP_POPULATE and a cold cache. The read syscall version has to actually do IO in the timed region; the mmap(MAP_POPULATE) version just does TLB misses and memcpy.<p>edit: actually, sorry, I think the article points this out, mostly correctly:<p>&gt; We will come back to __memmove_avx_unaligned_erms in a moment, but for the time being letâ€™s try to figure out exactly how much time is spent mapping pages. I have a neat trick up my sleeve to do that. On Linux, the mmap system call can accept a MAP_POPULATE flag. What this flag does is it forces mmap to pre-populate all the page mappings during the actual system call, so none of the page-mapping work would be done when my test actually runs. So I changed my test to invoke mmap with MAP_POPULATE and learned that the experiment completes about 36% faster. (I only measure the timing of the main loop, and not that of the mmap system call). Therefore, I assume that in the above profile all those mapping functions take up about 36%.<p>They didn&#x27;t point out that it doesn&#x27;t actually do any IO in the main loop either then, but maybe they were only running the warm cache variant by here anyway. And it seems like they didn&#x27;t use MAP_POPULATE when generating the comparison graphs earlier in the article.')