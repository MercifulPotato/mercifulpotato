Item(by='zaroth', descendants=None, kids=[25806443, 25809793, 25808867, 25811922], score=None, time=1610838428, title=None, item_type='comment', url=None, parent=25805635, text='EDIT: The article linked by qqii [1] is much better and actually answers all these questions. In short, the smart contracts to allow the loan and to allow the 5x leverage position were totally buggy.<p>[1] - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=25806183" rel="nofollow">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=25806183</a><p>I used to do some work on Bitcoin, but this all reads like some Cirque du Soleil fever dream.<p>These market making smart contracts will trade at 50% swings within a single block?<p>&gt; <i>The core of this trade utilises a margin trade on a DEX (bZx) to increase the price of WBTC&#x2F;ETH on another DEX (Uniswap) and thus creates an arbitrage opportunity. The trader then borrows WBTC using ETH as collateral (on Compound), and then purchases ETH at a “cheaper” price on the distorted (Uniswap) DEX market. To maximise the profit, the adversary then converts the “cheap” ETH to purchase WBTC at a non-manipulated market price over a period of two days after the flash loan.</i><p>So we start with a flash loan of ETH, go through two smart contracts to end up holding 112 “WBTC” against their borrowed 5,500 ETH.<p>&gt; <i>In steps 4 , the trader opens a short position for ETH against WBTC (on bZx), with a 5× leverage.</i><p>I’m having trouble parsing this sentence. What exactly does this mean?<p>&gt; <i>Upon receiving this request, bZx transacts 5,637.62 ETH on an exchange (Uniswap) for only 51.35 WBTC (at 109.79 ETH&#x2F;WBTC).</i><p>What does ‘transacts’ mean in this sentence? And bZx is offering an anonymous trader 5x leverage... based on what?<p>I think they are selling ETH to buy WBTC which blows out the order book and ends up crashing the price of ETH from 30ETH&#x2F;WBTC to 100ETH&#x2F;WBTC?<p>&gt; <i>Note that at the start of block 9484688, Uniswap has a total supply of 2,817.77 ETH and 77.09 WBTC (at 36.55 ETH&#x2F;WBTC).</i><p>I’m not sure why the total supply on Uniswap of each token is expressed as a <i>price</i>?<p>The trader then converts 112.00 WBTC to 6,871.41 ETH at 61.35 ETH&#x2F;WBTC on Uniswap. Recall they started off by getting 112 WBTC for 5,500 ETH.<p>&gt; <i>In step 6 the trader pays back the loan, paying a 1×10^11 Wei fee. Note that dYdX only requires a fee of 1 Wei.</i><p>No idea what Wei are or what the significance is of why they would pay 100 billion of them instead of 1, where they come from or how they are accounted for in the profitability.<p>&gt; <i>After the flash loan transaction (i.e. the first part of this pump and arbitrage trade), the trader gained 71.41 ETH...</i><p>Wait, I thought they had netted ~1,209 ETH, where does this 71.41 come from?<p>&gt; <i>...and has an over-collateralized loan of 5,500 ETH for 112 WBTC (49.10 ETH&#x2F;WBTC).</i><p>What happened to the 5x leveraged short position?<p>And how in the world did they coordinate all of these separate and interlinked orders to execute in multiple transactions all in the same block in an <i>atomic</i> fashion?<p>Anyway, in the end they need to give back the WBTC by buying WBTC with the ETH they netted;<p>&gt; <i>In total, the adversarial trader exchanged 4, 377.72 ETH for 112 WBTC (at 39.08 ETH&#x2F;WBTC) to redeem 5, 500.00 ETH.</i> (over the following two days)<p>Look... whatever people are out there building on these networks, this is just bizarre.')