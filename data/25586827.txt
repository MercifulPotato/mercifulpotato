Item(by='pornel', descendants=None, kids=None, score=None, time=1609366546, title=None, item_type='comment', url=None, parent=25584652, text='The actual implementation is bit of a fudge for performance reasons, but the general idea is based around amount of entropy: if a patch of an image already contains noise or intricate details, then I don&#x27;t disturb it further with dithering. If it&#x27;s flat, then it&#x27;s safe to dither.<p>I also use Sobel edge detection and suppress diffusion at the edges, which fixes a particular quirk of FS where error is accumulated throughout a flat area and gets countered only at the edge when color changes (e.g. if an area should be brighter than the brightest color you have in your palette, dithering is unable to fix it, but all the &quot;needs to be brighter!!!&quot; error will accumulate and blow on next pixel that was supposed to be dark).')