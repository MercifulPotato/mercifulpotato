Item(by='JoachimSchipper', descendants=None, kids=None, score=None, time=1609359985, title=None, item_type='comment', url=None, parent=25582962, text='Protobuf&#x27;s variable-length lengths are indeed annoying, but can&#x27;t you encode back-to-front as in ASN.1? That lets you write your lengths just after encoding the value, which should work (but may leave your data in e.g. bytes 20+ of a buffer; depending on interfaces, you may need to do one final copy to move the data to the start of the buffer.)<p>(ASN.1 and protobuf are both tag-length-value formats with variable-length integer encodings... h&#x2F;t to tptacek for mentioning that particular trick.)')