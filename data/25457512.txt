Item(by='kazinator', descendants=None, kids=None, score=None, time=1608224929, title=None, item_type='comment', url=None, parent=25456252, text='<p><pre><code>        movq    %rdi, -24(%rsp)\n        movq    -24(%rsp), %rax\n</code></pre>\nIt&#x27;s amazing that this pattern isn&#x27;t caught by peephole optimization.<p>Assuming we want %rdi to end up in both destinations, memory and %rax, that wants to be:<p><pre><code>        movq    %rdi, -24(%rsp)\n        movq    %rdi, %rax\n</code></pre>\nIs it true that we do not want it in both destinations? It&#x27;s as if the code is trying to be compatible with two conventions for returning small structs, which could be a legitimate requirement. A library function catering to two conventions at the same time will be compatible with client code compiled with either one without itself having to be recompiled.')