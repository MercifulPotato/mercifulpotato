Item(by='DonHopkins', descendants=None, kids=None, score=None, time=1611864431, title=None, item_type='comment', url=None, parent=25947319, text='FWIW here&#x27;s the original 68k SimCity &quot;Classic&quot; (open source Micropolis) save function, which I&#x27;ve long since cleaned up and put in byte swapping to make it portable to SPARC and x86, but yes it is just writing out some big buffers of memory with a function that now swaps bytes:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;SimHacker&#x2F;micropolis&#x2F;blob&#x2F;master&#x2F;MicropolisCore&#x2F;src&#x2F;MicropolisEngine&#x2F;src&#x2F;fileio.cpp#L340" rel="nofollow">https:&#x2F;&#x2F;github.com&#x2F;SimHacker&#x2F;micropolis&#x2F;blob&#x2F;master&#x2F;Micropol...</a><p>Here&#x27;s some original SimCity 2000 Mac code that saves the city into Mac resources (not the flat part of the file, but the Mac resource fork) -- CompGameWrite actually does some simple run length compression of the raw memory:<p><pre><code>    Boolean DoSave(short VolNum,Byte *name){\n    long count,CountTotal;\n    short i,j,filnum;\n    short x, y;\n    Byte *SaveText[] = {&quot;\\pGame Saved As:&quot;,NIL,NIL};\n    FInfo info;\n    Byte *NotCity[] = {\n        &quot;\\pSimCity 2000Âª will not save over a non-city file.&quot;,\n        &quot;\\pTry to save again using a different name.&quot;,\n        NIL,\n    };\n\n        if (name[0]&gt;20) name[0] = 20;\n\n    #ifndef DEBUG\n        if (GetFInfo(name,VolNum,&amp;info)==0 &amp;&amp; info.fdType!=CITYTYPE_ID) {\n            MessageDialog(NotCity);\n            return FALSE;\n        }\n    #endif\n\n        if (FSOpen(name,VolNum,&amp;filnum)!=noErr) {\n            if (GameError(Create(name,VolNum,APPLICATION_ID,CITYTYPE_ID))) return FALSE;\n            if (GameError(FSOpen(name,VolNum,&amp;filnum))) return FALSE;\n        }\n\n        if (!WriteHeader(filnum,0L)) return FALSE;\n        WriteLength = 4;        &#x2F;&#x2F; includes &#x27;SCDH&#x27; but not header\n\n    &#x2F;&#x2F;*** Write ***\n        if (!MiscWrite(filnum)) return FALSE;\n        if (!GameWrite(filnum,&#x27;ALTM&#x27;,(Ptr)AltMap[0])) return FALSE;\n\n        if (!CompGameWrite(filnum,&#x27;XTER&#x27;,(Ptr)TerrainMap[0])) return FALSE;\n        if (!CompGameWrite(filnum,&#x27;XBLD&#x27;,(Ptr)BuildMap[0])) return FALSE;\n        if (!CompGameWrite(filnum,&#x27;XZON&#x27;,(Ptr)ZoneMap[0])) return FALSE;\n        if (!CompGameWrite(filnum,&#x27;XUND&#x27;,(Ptr)UnderMap[0])) return FALSE;\n\n        if (!CompGameWrite(filnum,&#x27;XTXT&#x27;,(Ptr)TextMap[0])) return FALSE;\n        if (!CompGameWrite(filnum,&#x27;XLAB&#x27;,(Ptr)LabelArray)) return FALSE;\n        if (!CompGameWrite(filnum,&#x27;XMIC&#x27;,(Ptr)MicroRecord)) return FALSE;\n        if (!CompGameWrite(filnum,&#x27;XTHG&#x27;,(Ptr)ThingList)) return FALSE;\n        if (!CompGameWrite(filnum,&#x27;XBIT&#x27;,(Ptr)BitsMap[0])) return FALSE;\n\n        if (!CompGameWrite(filnum,&#x27;XTRF&#x27;,(Ptr)TrafficMap[0])) return FALSE;\n        if (!CompGameWrite(filnum,&#x27;XPLT&#x27;,(Ptr)PolluteMap[0])) return FALSE;\n        if (!CompGameWrite(filnum,&#x27;XVAL&#x27;,(Ptr)ValueMap[0])) return FALSE;\n        if (!CompGameWrite(filnum,&#x27;XCRM&#x27;,(Ptr)CrimeMap[0])) return FALSE;\n\n        if (!CompGameWrite(filnum,&#x27;XPLC&#x27;,(Ptr)PoliceMap[0])) return FALSE;\n        if (!CompGameWrite(filnum,&#x27;XFIR&#x27;,(Ptr)FireMap[0])) return FALSE;\n        if (!CompGameWrite(filnum,&#x27;XPOP&#x27;,(Ptr)PopMap[0])) return FALSE;\n        if (!CompGameWrite(filnum,&#x27;XROG&#x27;,(Ptr)ROGMap[0])) return FALSE;\n\n        if (!CompGameWrite(filnum,&#x27;XGRP&#x27;,(Ptr)GraphData[0])) return FALSE;\n\n    &#x2F;&#x2F;*** Close ***\n        WriteHeader(filnum,WriteLength);\n        GameError(SetEOF(filnum,WriteLength+8));  &#x2F;&#x2F; 8 bytes for file header\n        GameError(FSClose(filnum));\n        GameError(FlushVol(NIL,VolNum));\n\n        BlockMove(name,CityStr,21);\n        DateCashTitle();\n        FilVolNum = VolNum;\n\n    &#x2F;&#x2F;*** SUCCESS! ***\n        SaveText[1] = CityStr;\n        MessageDialog(SaveText);\n        return TRUE;\n    }\n</code></pre>\nAnd here&#x27;s the Mac SimEarth save function, which looks like it just write out raw uncompressed memory -- the Mac memory manager has a GetPtrSize function that (obviously) tells you the size of the memory allocated for a pointer:<p><pre><code>    DoSave(VolNum,name)\n    int VolNum;\n    Str255 name;\n    {\n    long count,CountTotal;\n    int i,FilNum;\n\n        if (EqualString(name,&quot;\\pSimEarth&quot;,FALSE,TRUE)) {\n            MessageDialog( &quot;\\pERROR!!&quot;,\n                            &quot;\\pThe name &#x27;SimEarth&#x27; is reserved&quot;,\n                            &quot;\\pfor this application.&quot;,1);\n            return;\n        }\n\n        if (FSOpen(name,VolNum,&amp;FilNum)) {\n            if (GAIAError(Create(name,VolNum,&#x27;MYCR&#x27;,&#x27;SAVE&#x27;))) return;\n            if (GAIAError(FSOpen(name,VolNum,&amp;FilNum))) return;\n        }\n        else if (GAIAError(SetFPos(FilNum,fsFromStart,0L))) {\n            GAIAError(FSClose(FilNum));\n            return;\n        }\n\n    &#x2F;**Write**&#x2F;\n        CountTotal = (count=GetPtrSize(Map[0]));\n        if (GAIAError(FSWrite(FilNum,&amp;count,Map[0]))) return;\n\n        CountTotal += (count=GetPtrSize(Life[0]));\n        if (GAIAError(FSWrite(FilNum,&amp;count,Life[0]))) return;\n\n        CountTotal += (count=GetPtrSize(OcTempMap[0]));\n        if (GAIAError(FSWrite(FilNum,&amp;count,OcTempMap[0]))) return;\n\n        CountTotal += (count=GetPtrSize(OcCurrentMap[0]));\n        if (GAIAError(FSWrite(FilNum,&amp;count,OcCurrentMap[0]))) return;\n\n        CountTotal += (count=GetPtrSize(DriftMap[0]));\n        if (GAIAError(FSWrite(FilNum,&amp;count,DriftMap[0]))) return;\n\n        CountTotal += (count=GetPtrSize(EventMap[0]));\n        if (GAIAError(FSWrite(FilNum,&amp;count,EventMap[0]))) return;\n\n        CountTotal += (count=GetPtrSize(SAirTempMap[0]));\n        if (GAIAError(FSWrite(FilNum,&amp;count,SAirTempMap[0]))) return;\n\n        CountTotal += (count=GetPtrSize(SCloudDensity[0]));\n        if (GAIAError(FSWrite(FilNum,&amp;count,SCloudDensity[0]))) return;\n\n        CountTotal += (count=GetPtrSize(SAirCurrentMap[0]));\n        if (GAIAError(FSWrite(FilNum,&amp;count,SAirCurrentMap[0]))) return;\n\n        PutParameters();\n        CountTotal += (count=GetPtrSize(MiscHis));\n        if (GAIAError(FSWrite(FilNum,&amp;count,MiscHis))) return;\n\n    &#x2F;**Close**&#x2F;\n        GAIAError(SetEOF(FilNum,CountTotal));  \n        GAIAError(FSClose(FilNum));\n        GAIAError(FlushVol(NIL,VolNum));\n\n        BlockMove(name,EwinStr,256); \n        SetWTitle(editWindow,EwinStr);\n        MessageDialog(&quot;\\pSave Complete:&quot;,EwinStr,&quot;&quot;,1);\n        EnableItem(GetMHandle(301),3);  &#x2F;* Save *&#x2F;\n        FilVolNum = VolNum;\n    }</code></pre>')