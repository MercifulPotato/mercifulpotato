Item(by='scaramanga', descendants=None, kids=None, score=None, time=1610253189, title=None, item_type='comment', url=None, parent=25702446, text='Yes, the test is sort of a strange one because the read test is reading directly in to the final destination wheras mmap is not and doing a redundant copy instead. So it&#x27;s not your typical &quot;eliminate a copy and go faster&quot; usage of mmap.<p>What it actually seems to be comparing is whether its faster if the copy happens in the kernel, in the read() system call, or whether it&#x27;s faster in userspace.<p>The results are puzzling because I would expect the kernel to be faster since it would incur no page-faults to access the pages from page cache since those ought to fall under the page-global mappings, or, at least, be in the kernels linear ram map which use 1GB pages (edit: in either case, not incur faults for demand map&#x2F;demand load). But maybe that&#x27;s no longer the case in a post-spectre world?<p>So I think actually it&#x27;s a test of &quot;does AVX go enough-faster to outweigh the costs of the extra-pagefaults incurred by copying from a user-space mapping which has not been prefaulted&quot;<p>Sounds like the answer is yes (which still surprises me). And I expect if they MAP_POPULATE it would pull even further ahead...')