Item(by='rectang', descendants=None, kids=None, score=None, time=1603224348, title=None, item_type='comment', url=None, parent=24841556, text='I tried to simplify the example code for the sake of clarity.<p>While I acknowledge it would be unusual to provide a library API for finding the value of the last code point specifically, most string libraries provide something like a &quot;codePointAt&quot; function to return the code point at a specific offset.  You&#x27;ll run into the same problem with DECODE_UTF8 there.<p><pre><code>    int32_t\n    code_point_at(const char *s, size_t len, size_t offset) {\n        const char *end = s + len;\n        while (s &lt; end &amp;&amp; offset &gt; 0) {\n            &#x2F;&#x2F; Move forward by 1-4 bytes depending on header byte value.\n            s += UTF8_SKIP(s);\n            offset--;\n        }\n        if (s &gt;= end) {\n            return -1;\n        }\n        return DECODE_UTF8(s); &#x2F;&#x2F; BOOM! May read beyond string end\n    }</code></pre>')