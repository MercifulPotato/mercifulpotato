Item(by='tsimionescu', descendants=None, kids=None, score=None, time=1605381687, title=None, item_type='comment', url=None, parent=25091729, text='&gt; &gt;  I was also (incorrectly) assuming that renaming a file after having fsynced the contents is a valid mechanism<p>&gt; Where does anyone say that this doesn&#x27;t work?<p>The article explains it here:<p>&gt; This trick doesn&#x27;t work. People seem to think that this is safe becaus the POSIX spec says that rename is atomic, but that only means rename is atomic with respect to normal operation, that doesn&#x27;t mean it&#x27;s atomic on crash. This isn&#x27;t just a theoretical problem; if we look at mainstream Linux filesystems, most have at least one mode where rename isn&#x27;t atomic on crash. Rename also isn&#x27;t guaranteed to execute in program order, as people sometimes expect.<p>According to the article, open+write+fsync+close+dir-fsync is indeed safe on ext4 on any new-ish Linux kernel (on older kernels, fsync() wouldn&#x27;t report errors in some cases, e.g. if it happened after the FS attempted and failed to write the data before the fsync).<p>Not sure what it has to do with rename though.')