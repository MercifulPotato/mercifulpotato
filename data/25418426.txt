Item(by='ludocode', descendants=None, kids=[25421093, 25418509, 25420638], score=None, time=1607958788, title=None, item_type='comment', url=None, parent=25417479, text='I would tend to agree with you. Unfortunately this proposal is for much more than just block scope cleanup.<p>This proposal contains a specification for complete stack unwinding in C. It doesn&#x27;t just specify defer, but also panic and recover, which jumps between functions and cleans up guard blocks across stack frames. It&#x27;s essentially exceptions for C. This is frankly horrifying and I can&#x27;t believe the C standards committee is entertaining this.<p>They claim that this is a separable feature from defer, so maybe they intend for defer to be mandatory and panic&#x2F;recover to be optional. But much of the design of defer is to support their panic&#x2F;recover mechanism. This makes it much more complicated than attribute((cleanup)). If they want defer to be taken seriously, they should move all of the panic&#x2F;recover stuff to a separate proposal. I suspect if they did this, a lot of the design recommendations they&#x27;ve made for defer wouldn&#x27;t make sense on their own.')