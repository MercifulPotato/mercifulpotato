Item(by='toast0', descendants=None, kids=None, score=None, time=1611985593, title=None, item_type='comment', url=None, parent=25965414, text='&gt; For a while now I had operated under the assumption that CPU-based crypto with AES-GCM was faster than most hardware offload cards. What makes the Mellanox NIC perform better?<p>&gt; I.e.: Why does memory bandwidth matter to TLS? Aren&#x27;t you encrypting data &quot;on the fly&quot;, while it is still resident in the CPU caches?<p>It may depend on what you&#x27;re sending. Netflix&#x27;s use case is generally sending files. If you&#x27;re doing software encryption you would load the plain text file into memory (via the filesystem&#x2F;unified buffer cache), then write the (session specific) encrypted text into separate memory, then tell give that memory to the NIC to send out.<p>If the NIC can do the encryption, you would load the plain text into memory, then tell the NIC to read from that memory to encrypt and send out. That saves at least a write pass, and probably a read pass. (256 MB of L3 cache on latest EPYC is a lot, but it&#x27;s not enough to expect cached reads from the filesystem to hit L3 that often, IMHO)<p>If my guestimate is right, a cold file would go from hitting memory 4 times to hitting it twice. And a file in disk cache would go from 3 times to once; the CPU doesn&#x27;t need to touch the memory if it&#x27;s in the disk cache.<p>Not that this is a totally different case from encrypting dynamic data that&#x27;s necessarily touched by the CPU.<p>&gt; You&#x27;re basically complaining that you&#x27;re unable to get a mere 10% of the expected throughput. But put in absolute terms, that&#x27;s 40 Gbps, which is about 10x more than what a typical server in 2020 can put out on the network. (Just because you have 10 Gbps NICs doesn&#x27;t mean you can get 10 Gbps! Try iperf3 and you&#x27;ll be shocked that you&#x27;re lucky if you can crack 5 Gbps in practice)<p>I had no problem serving 10 Gbps of files on a dual Xeon E5-2690 (v1; a 2012 CPU), although that CPU isn&#x27;t great at AES, so I think it only did 8 Gbps or so with TLS; the next round of servers for that role had 2x 10G and 2690 v3 or v4 (2014 or 2016; but I can&#x27;t remember when we got them) and thanks to better AES instructions, they were able to do 20 G (and a lot more handshakes&#x2F;sec too). If your 2020 servers aren&#x27;t as good as my circa 2012 servers were, you might need to work on your stack. OTOH, bulk file serving for many clients can be different than a single connection iperf.')