Item(by='eqvinox', descendants=None, kids=[25425775], score=None, time=1607966569, title=None, item_type='comment', url=None, parent=25419995, text='The fact that the loop case is rare does not mean it isn&#x27;t still problematic.  It&#x27;s creating a new opportunity to shoot yourself in the foot while trying to solve another one.  (This is with the separate guard{} block.)<p>I would strongly agree that the dedicated guard{} block is a bad idea and this should just tie into the innermost scope.  I see what this is trying to do (&quot;if (...) { foo.x = malloc(); defer free(foo.x); }&quot;) but you don&#x27;t solve a UI problem (as in, user interface for the programmer to their code) by adding more weird UI.<p>(&quot;Worst&quot; example for shooting yourself in the foot: defer inside macros.  Programmer then forgets that the macro contains a defer, and the defer defaults to the function-implicit outer guard block.  But it&#x27;s really in a nested loop.  That&#x27;s gonna be a fun week of debugging...  much less of a risk when you have the guarantee in terms of innermost scope.)')