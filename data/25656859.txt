Item(by='avianlyric', descendants=None, kids=[25656998], score=None, time=1609933703, title=None, item_type='comment', url=None, parent=25656795, text='Not 100% about the newest versions of Postgres. But certainly in older versions CTEs created query planner boundaries.<p>So the planner would optimise each CTE separately, but wouldnâ€™t optimise the entire query with all CTEs together, which of course can result in some slightly nonsensical query plans.<p>To my knowledge this is considered a limitation rather than a feature as it can cause performance issues with some queries.<p>EDIT:\nSome quick Googling suggests the CTEs are no longer optimisation fences, and their handling can be tweaked on a CTE by CTE basic in Postgres 12 onwards [1]<p>[1] <a href="https:&#x2F;&#x2F;www.depesz.com&#x2F;2019&#x2F;02&#x2F;19&#x2F;waiting-for-postgresql-12-allow-user-control-of-cte-materialization-and-change-the-default-behavior&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.depesz.com&#x2F;2019&#x2F;02&#x2F;19&#x2F;waiting-for-postgresql-12-...</a>')