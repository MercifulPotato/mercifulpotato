Item(by='LinuxBender', descendants=None, kids=[25739917, 25737929, 25741149, 25740747], score=None, time=1610401552, title=None, item_type='comment', url=None, parent=25737611, text='It would be very unusual for an ISP to drop idle connections.  This implies all your connections are going through a layer 4 router.  More likely you have a statefull firewall in the path somewhere.  <i>home router, server ISP firewall, etc...</i><p>[Edit: ] Or in this case, an ISP in Denmark that is trying to minimize ipv4 cost by using LSN (carrier grade nat) which also has many other drawbacks.<p><i>A SSH session does not generate any traffic</i><p>This does not have to be true.  You can enable TCP keepalive in the server and client configuration.<p>Client via ~&#x2F;.ssh&#x2F;config:<p><pre><code>  TCPKeepAlive yes\n  ServerAliveInterval 60\n  ServerAliveCountMax 2\n</code></pre>\nServer via &#x2F;etc&#x2F;ssh&#x2F;sshd_config:<p><pre><code>  TCPKeepAlive yes\n  ClientAliveInterval 60\n  ClientAliveCountMax 2\n</code></pre>\n<i>Why are the TCP keepalives only sent after 2 hours?</i><p>Each OS has a default time set for keepalives.  If you do not specify it in the ssh config, it will use the OS default.  In Linux, you can set this in &#x2F;etc&#x2F;sysctl.conf:<p><pre><code>  net.ipv4.tcp_keepalive_time = 60\n  net.ipv4.tcp_keepalive_intvl = 60\n  net.ipv4.tcp_keepalive_probes = 2\n</code></pre>\n<i>After adding this, run sysctl -e -p</i><p>You can see the timers on your established connections with:<p><pre><code>  ss -emoian | grep tim\n</code></pre>\nNote: TCP timers are not the same as ssh client and sshd server tcp keepalive packets.  These are two distinctly different mechanisms that can accomplish the same thing.  Not all applications support TCP socket keepalive.  You can wrap applications with a library called libkeepalived to add support without code changes by using LD_PRELOAD.<p>In Windows this is set in the registry [1]  On mac this is set via sysctl similar to Linux.<p>After you have adjusted your client and server config, restarted sshd on the server, then ssh to your server using the flag -vv and you will see the keepalive packets.<p>[1] - <a href="https:&#x2F;&#x2F;serverfault.com&#x2F;questions&#x2F;735515&#x2F;tcp-timeout-for-established-connections-in-windows" rel="nofollow">https:&#x2F;&#x2F;serverfault.com&#x2F;questions&#x2F;735515&#x2F;tcp-timeout-for-est...</a>')