Item(by='chubot', descendants=None, kids=[24747381], score=None, time=1602398357, title=None, item_type='comment', url=None, parent=24741734, text='Yeah I didn&#x27;t explain that very well.  It&#x27;s actually a variation on the problem here:<p><a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=24738274" rel="nofollow">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=24738274</a><p>except with a shell function rather than a subshell.<p>Demo:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;oilshell&#x2F;blog-code&#x2F;blob&#x2F;master&#x2F;errexit" rel="nofollow">https:&#x2F;&#x2F;github.com&#x2F;oilshell&#x2F;blog-code&#x2F;blob&#x2F;master&#x2F;errexit</a>\n&#x2F;demo.sh#L21<p>Run .&#x2F;demo.sh subshell-compare and   func-compare.<p>I have seen multiple people point it out as confusing.  The problem is that in the first case, there are two exit codes:<p>1. false (suppressed on LHS of &amp;&amp;)<p>2. true<p>And in the second case, there are 3:<p>1. false (suppressed on LHS of &amp;&amp;)<p>2. true<p>3. the exit code of the function&#x2F;subshell, which is the exit code of the last statement, which is nonzero.  This then CAUSES THE PROGRAM TO FAIL, whereas it didn&#x27;t before.<p>(edit: removed incorrect code)<p>-----<p>So it&#x27;s kind of like a &quot;ghost&quot; exit code created by the subshell&#x2F;function!  Which has an unexpected interaction with errexit.<p>Does that make sense?<p>I am not sure exactly how to fix it, but it will probably involve limiting &amp;&amp; to stuff like this:<p><pre><code>    if test -d &#x2F;tmp &amp;&amp; test -d &#x2F;tmp&#x2F;foo; then echo yes; fi\n</code></pre>\nAnd disallow it when standing alone, because it doesn&#x27;t make much sense there, if errexit is on.<p>Feel free to chime in bug with any possible solutions or more problems.<p>----<p>(And yes Oil fixes the brace problem with shopt -s parse_brace, which is on by default in Oil!  Try it out and let me know if you like it :) )')