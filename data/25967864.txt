Item(by='kazinator', descendants=None, kids=None, score=None, time=1612001850, title=None, item_type='comment', url=None, parent=25966901, text='<i>with</i> macros in Lisp tend to be sanely designed: they explicitly list the symbols that are to be introduced into the scope. I don&#x27;t think I&#x27;ve never seen a &quot;bring the whole set of the currently defined slots of this class&#x2F;struct into this scope as locals&quot;.<p>Oh, you can do it.<p><pre><code>  his is the TXR Lisp interactive listener of TXR 249.\n  Quit with :quit or Ctrl-D on an empty line. Ctrl-X ? for cheatsheet.\n  Use full-strength TXR for tough tasks, or dilute with shell scripts.\n  1&gt; (defmacro with (struct obj . body)\n       (with-gensyms (obj-sym)\n         ^(let ((,obj-sym ,obj))\n            (symacrolet ,(mapcar (op list @1 ^(qref ,obj-sym ,@1)) (slots struct)) \n              ,*body))))\n  with\n  2&gt; (with time (time-struct-utc (time))\n       (list year month day))\n  (2021 1 30)\n</code></pre>\nExpansion:<p><pre><code>  3&gt; (macroexpand &#x27;(with time (time-struct-utc (time))\n       (list year month day)))\n  (let ((#:g0016 (time-struct-utc (time))))\n    (symacrolet ((time-local\n                  #:g0016.time-local)\n                 (time-utc #:g0016.time-utc)\n                 (time-string\n                  #:g0016.time-string)\n                 (time-parse #:g0016.time-parse)\n                 (year #:g0016.year)\n                 (month #:g0016.month)\n                 (day #:g0016.day)\n                 (hour #:g0016.hour)\n                 (min #:g0016.min)\n                 (sec #:g0016.sec)\n                 (dst #:g0016.dst)\n                 (gmtoff #:g0016.gmtoff)\n                 (zone #:g0016.zone))\n      (list year month\n            day)))\n</code></pre>\nTotal expansion; symacrolet gone, a.b desugared into (slot a &#x27;b):<p><pre><code>  4&gt; (expand &#x27;(with time (time-struct-utc (time))\n       (list year month day)))\n  (let ((#:g0017 (time-struct-utc (time))))\n    (list (slot #:g0017 &#x27;year)\n          (slot #:g0017 &#x27;month)\n          (slot #:g0017 &#x27;day)))</code></pre>')