Item(by='LockAndLol', descendants=1, kids=[25314543], score=1, time=1607175930, title='Ask HN: How can I contain an app and force all network traffic through a proxy?', item_type='story', url=None, parent=None, text='A while ago I started a project i2p-docker-proxy [1] (that didn&#x27;t get very far) with the goal of containing any app and all its network traffic to force it through I2P[2] (an overlay network like TOR[3] better adapted to P2P). The absolutely minimal docs show what&#x27;s going on [4]<p>It&#x27;s theoretically possible to start apps with HTTP_PROXY outside of docker, but there&#x27;s no guarantee they will use it, hence the project.\nThe choice at the time was docker, since it&#x27;s the only thing I knew (and still know). The project in its current state is able to curl eepsites (equivalent of a hidden onion service in TOR) aka successful containment.\n<i></i>However<i></i>, that&#x27;s where it ends: only clients work and servers won&#x27;t be accessible from within the container.<p>The solution isn&#x27;t optimal because it depends on docker meaning 1 container for I2P, another one for the app. Furthermore all traffic has to go through the transparent proxy in the app container.<p>I have considered writing a TUN&#x2F;TAP device and creating a cgroup that uses that virtual network device, but I know nothing about those 2 subjects besides their concepts. It&#x27;s therefore difficult to evaluate feasibility.<p>Things to take into consideration:<p>- It should run on linux<p>- DNS requests will be made by the app and have to be handled (see docs[4] on a functioning yet unoptimised proposal)<p>- Non-overlay traffic shouldn&#x27;t escape the container<p>- client&#x2F;server applications should be able to work with other services in the overlay network (send&#x2F;receive)<p>Any suggestions?<p>[1]: https:&#x2F;&#x2F;gitlab.com&#x2F;NamingThingsIsHard&#x2F;privacy&#x2F;i2p-docker-proxy<p>[2]: https:&#x2F;&#x2F;geti2p.net&#x2F;<p>[3]: https:&#x2F;&#x2F;torproject.org&#x2F;<p>[4]: https:&#x2F;&#x2F;namingthingsishard.gitlab.io&#x2F;privacy&#x2F;i2p-docker-proxy&#x2F;architecture.html')