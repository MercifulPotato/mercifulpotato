Item(by='pwdisswordfish5', descendants=None, kids=None, score=None, time=1609148239, title=None, item_type='comment', url=None, parent=25556286, text='Cute trick, but probably fragile. It basically requires either writing functions like memcpy in assembly by hand or parsing the compiler-generated assembly post-codegen to determine the actual set of register clobbers. Otherwise it is bound to be broken as soon as the register allocator decides to clobber a different set of registers when generating the function.<p>Also, this effectively makes the body of the function a part of its public ABI, which makes it morally equivalent to inlining; it requires users of the function to be recompiled each time the body (and in consequence the clobber set) is changed. But since this seems to be static-linking-only library, this seems not that much of a problem in this case.<p>Still, Iâ€™m expecting improvements to whole-program LTO and inter-procedural optimisations to render this hack obsolete.')