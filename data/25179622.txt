Item(by='adrusi', descendants=None, kids=None, score=None, time=1606069412, title=None, item_type='comment', url=None, parent=25176531, text='By far my favorite trick is the one described here <a href="https:&#x2F;&#x2F;www.chiark.greenend.org.uk&#x2F;~sgtatham&#x2F;coroutines.html" rel="nofollow">https:&#x2F;&#x2F;www.chiark.greenend.org.uk&#x2F;~sgtatham&#x2F;coroutines.html</a><p>Effectively generators a la python or javascript, implemented using a set of macros that expand to a Duff&#x27;s device control structure.<p><pre><code>    #define crBegin(state) \\\n        int *__state_ptr__ = &amp;(state); \\\n        *__state_ptr__ = 0; \\\n        switch(*__state_ptr__) { case 0:\n    #define yield(x) \\\n        do { \\\n            *__state_ptr__ = __LINE__; \\\n            return x; \\\n            case __LINE__:; \\\n        } while (0)\n    #define crFinish }\n    \n    struct counter_frame {\n        int state;\n        int i;\n    };\n    \n    int counter(struct counter_frame *frame) {\n        crBegin(frame-&gt;state);\n        frame-&gt;i = 0;\n        while (1) {\n            yield(frame-&gt;i++);\n        }\n        crFinish;\n    }\n    \n    int main() {\n        struct counter_frame my_counter;\n        while (1) {\n            printf(&quot;%d\\n&quot;, counter(&amp;my_counter));\n        }\n        return 0;\n    }</code></pre>')