Item(by='ncmncm', descendants=None, kids=None, score=None, time=1607113778, title=None, item_type='comment', url=None, parent=25305518, text='The difficult part is not expressing it. Rather, it is persuading the compiler that the target implements the instruction. gcc and clang have to be convinced they are generating code for an amd64 chip manufactured since 2002 (for which &quot;-mpopcnt&quot; usually works). Common Linux distributions don&#x27;t turn on any such flags. MSVC offers no way to persuade it, but it will issue the instruction anyway if you use its intrinsic, _popcntN(x), where N is 16, 32, or 64. Shipping Microsoft code doesn&#x27;t; it is all supposed to work on the oldest amd64 chips ever made.<p>C++98 gave us std::bitset&lt;N&gt;(x).count(). With C++20 we have std::popcount(x). But getting the compiler to produce the instruction reliably and portably is no easier than before.')