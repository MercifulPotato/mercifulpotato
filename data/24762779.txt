Item(by='geocar', descendants=None, kids=[24763264], score=None, time=1602569757, title=None, item_type='comment', url=None, parent=24761511, text='Nail on head. Pthreads is an extremely difficult API to use, owing first to a poor choice of primitives, the consequences of which are that none of the implementations are particularly good and their interactions with the rest of the machine&#x2F;model are ill-defined.<p>For example: You know how hard it is to close() in a multithreaded program? [1] And that’s just one system call— one almost everyone thinks they understand. What hope is there for all the other pthreads-code?<p>For cond&#x2F;etc: One trick I use is handle passing via an epoll[2]. This works much more reliably than the pthreads API, and whilst it’s slower in a microbenchmark that spins the pthread_cond&#x2F;mutex&#x2F;etc apis, real programs don’t do that (or don’t need to), and so it is usually a clear net-win.<p>[1]: <a href="http:&#x2F;&#x2F;geocar.sdf1.org&#x2F;close.html" rel="nofollow">http:&#x2F;&#x2F;geocar.sdf1.org&#x2F;close.html</a><p>[2]: <a href="http:&#x2F;&#x2F;geocar.sdf1.org&#x2F;fast-servers.html" rel="nofollow">http:&#x2F;&#x2F;geocar.sdf1.org&#x2F;fast-servers.html</a>')