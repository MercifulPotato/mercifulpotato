Item(by='haberman', descendants=None, kids=None, score=None, time=1609369543, title=None, item_type='comment', url=None, parent=25587151, text='&gt; I&#x27;m was quite surprised you didnt offer your own stringview implementation (or something similar) the last time I looked at protobuf.<p>We sort of do actually: <a href="https:&#x2F;&#x2F;github.com&#x2F;protocolbuffers&#x2F;protobuf&#x2F;blob&#x2F;master&#x2F;src&#x2F;google&#x2F;protobuf&#x2F;stubs&#x2F;stringpiece.h" rel="nofollow">https:&#x2F;&#x2F;github.com&#x2F;protocolbuffers&#x2F;protobuf&#x2F;blob&#x2F;master&#x2F;src&#x2F;...</a><p>The internal version of protobuf lets you switch individual string fields to string_view using [ctype=STRING_PIECE], but migrating the default away from std::string is mainly just an enormous migration challenge.<p>Internally we also do something slightly nuts: we break the encapsulation of std::string so that we can point it to arena-allocated memory (we then &quot;steal&quot; the memory back before the destructor runs).  We can only afford to do this internally, where the implementation of std::string is known. The real long-term solution is to move to string_view.')