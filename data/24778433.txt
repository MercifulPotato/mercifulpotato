Item(by='rzimmerman', descendants=None, kids=[24782440], score=None, time=1602692747, title=None, item_type='comment', url=None, parent=24776771, text='&gt; Do not store secrets in environment variables<p>Yes, definitely don&#x27;t put secrets in the Dockerfile itself. I&#x27;m curious if there are reasons not to use a .env file though?<p>&gt; Only use trusted base images<p>This is a good sentiment, but docker hub also has plenty of images that are built directly from a github repo. You can inspect the Dockerfile and (as long as you trust Docker) trust that it was built as written. In this case I recommend pinning to a specific container SHA (image_name@sha256:...) in case the source repo gets compromised. For official images, you can pin to a tag IMO.<p>&gt; Do not use ‘latest’ tag for base image<p>Regardless of the security concerns, pinning to latest will probably bite you when there&#x27;s a major version bump (or even maybe a minor one). Imagine you built a container on ubuntu:latest when latest was 20.04 and some new employee gets hit with 22.04. That&#x27;s a bad surprise.<p>&gt; Avoid curl bashing<p>Evergreen fight here, but I agree with the author that you should at least validate checksums on external files before executing or using them.<p>&gt; Do not upgrade your system packages<p>This is where the throne of lies about Docker idempotency crumbles. You have to apt-get update because Debian&#x2F;Ubuntu repositories remove old versions when there are security fixes (not 100% sure on this, feel free to correct me). So if the ubuntu:20.04 image is released and there&#x27;s a security update in openssh-client, running &quot;apt-get install openssh-client&quot; without &quot;apt-get update&quot; will fail. So we all run &quot;apt-get update&quot; and pretend that the containers we build are time-invariant. They&#x27;re not, and in fact we occasionally get security updates snuck in there. Luckily Debian and Ubuntu do a good job not breaking things and no one complains. But if you build a container on Tuesday it&#x27;s not guaranteed to be the same as on Wednesday and there&#x27;s nothing you can do about that with a Debian distro. But it&#x27;s actually fine in practice so we pretend not to notice. The point about not running &quot;apt-get upgrade&quot; is kind of moot - you&#x27;re going to effectively be upgrading whatever you &quot;apt-get install&quot;, so it&#x27;s probably worth taking the same trade on the built-in packages.<p>Importantly, there&#x27;s no security risk - just a configuration one.<p>&gt; Do not use ADD if possible<p>Same as above - you should be checksumming external dependencies or self-hosting them.<p>&gt; Do not root<p>&gt; Do not sudo<p>I haven&#x27;t thought deeply about these. I&#x27;d prefer to trust the container system isolation rather than playing with users and permissions. I don&#x27;t understand this risk well enough to have a well-formed opinion.')