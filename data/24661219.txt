Item(by='Nullabillity', descendants=None, kids=None, score=None, time=1601635744, title=None, item_type='comment', url=None, parent=24657726, text='&gt; It seems to me that there must be some other language that would have the c++ guarantee, but I don&#x27;t know of it.<p>Rust&#x27;s Drop[0] has basically the same guarantees as C++: the destructor will run right before the memory is freed (although it is possible in both cases to also leak both). Combine with Pin[1] if you need the exact memory location to be stable as well.<p>&gt; it isn&#x27;t hard to implement<p>Sadly, it&#x27;s basically incompatible with tracing garbage collectors, since they make it completely unpredictable when the destructor will run.<p>So if you ever want to allow yourself to switch to tracing GC then you&#x27;ll either have to disallow it completely, or bury it in a hidden corner of the docs with a load of caveats (like Python or Java). And in the latter case you&#x27;ll still have people like the GP stumble upon it, say &quot;oh, this looks neat&quot;, and set up a really painful trap for their future selves.<p>[0]: <a href="https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;stable&#x2F;std&#x2F;ops&#x2F;trait.Drop.html" rel="nofollow">https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;stable&#x2F;std&#x2F;ops&#x2F;trait.Drop.html</a><p>[1]: <a href="https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;stable&#x2F;std&#x2F;pin&#x2F;index.html#drop-guarantee" rel="nofollow">https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;stable&#x2F;std&#x2F;pin&#x2F;index.html#drop-gua...</a>')