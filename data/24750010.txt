Item(by='broodbucket', descendants=None, kids=[24750834, 24750122], score=None, time=1602458932, title=None, item_type='comment', url=None, parent=24749949, text='I think that&#x27;s very subjective and situational.<p>The amdgpu driver has duplicated files for different versions of things, so it&#x27;ll have thing_v6.c and thing_v7.c and thing_v8.c with a lot of duplicated functions.<p>The more common way of doing something like this would be to have structs of function pointers that get populated based on what version of GPU you have.  You have one file with all the common functions that they can share, in the definitions for each GPU version you set the majority of the function pointers to the common version they all share and for ones that have to be different, you set them to their unique version.  That way you can define all the common functions once, and point to them in the structs for each version.<p>Having a quick flick through the code now, they do use structs of function pointers in each version for common operations but they still don&#x27;t abstract out the ones that are either identical or have very few differences that you could special case.<p>Refactoring such a giant driver for no performance gain is going to be extremely low on AMD&#x27;s todo list, so it&#x27;ll probably stay like that.  It just doesn&#x27;t look like anything else in the kernel')