Item(by='rectang', descendants=None, kids=[24841556, 24841945], score=None, time=1603222373, title=None, item_type='comment', url=None, parent=24840691, text='&gt; <i>I struggle to imagine such a function.</i><p>The following function will read invalid memory if there are missing trailing bytes:<p><pre><code>    int32_t\n    read_last_code_point(const char *s, size_t len) {\n        s += len; &#x2F;&#x2F; place pointer at end of string\n        while (!HEADER_BYTE(s)) { &#x2F;&#x2F; read backwards until header byte found\n            s--;\n        }\n        return DECODE_UTF8(s); &#x2F;&#x2F; BOOM! May read beyond string end\n    }\n</code></pre>\nTo fix it, you would either need to establish that the passed-in string was valid UTF-8, or you would need to add a bounds check to DECODE_UTF8, making it slower.<p>When you write string manipulation code, you come across this sort of issue all the time.  In isolation, maybe you&#x27;d want to fix this function by adding the bounds check.  But since you&#x27;re going to see this problem everywhere, you&#x27;ll probably solve it through an initial validation pass instead.')